function createBitmapByName(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e}var Animation=function(){function t(t,e,i){void 0===i&&(i=24),this.FPS=24,this.textureList=[],this.textureList=t,this.self=e,this.FPS=i,this.timePassed=0,this.curFrame=0}var e=(__define,t),i=e.prototype;return i.playCurcularly=function(t){this.timePassed+=t,this.timePassed>=1e3/this.FPS&&(this.timePassed-=1e3/this.FPS,this.curFrame=++this.curFrame%this.textureList.length,this.self.texture=RES.getRes(this.textureList[this.curFrame]))},i.playOnce=function(t,e){if(this.timePassed+=e,this.timePassed>=1e3/this.FPS){this.timePassed-=1e3/this.FPS;var i=this.textureList[t];this.curFrame<i.length&&(this.self.texture=RES.getRes(i[this.curFrame]),this.curFrame++)}},t}();egret.registerClass(Animation,"Animation");var StateMachine=function(){function t(t){this.time=0,this.curState=t,this.curState.onInit()}var e=(__define,t),i=e.prototype;return i.runMachine=function(t){var e=t,i=this.time,n=e-i;this.time=e,this.curState.onRun(n);var r=this.curState.onCheck();return typeof r!=typeof this.curState&&(this.curState.onExit(),this.curState=r,this.curState.onInit()),!0},i.switchState=function(t){this.curState=t},t}();egret.registerClass(StateMachine,"StateMachine");var LoadingUI=function(t){function e(){t.call(this),this.createView()}__extends(e,t);var i=(__define,e),n=i.prototype;return n.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},n.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var TIME=0,Main=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.createGameScene=function(){this.player=new Player,this.player.x=300,this.player.y=400,this.addChild(this.player),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},n.onTap=function(t){console.log("tap"),this.player.Move(new Vector2(t.stageX,t.stageY))},n.onAddToStage=function(t){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},n.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},n.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},n.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},n.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var Player=function(t){function e(){t.call(this),this.hp=200,this.isLeftFacing=!0,this.velocity=.3,this.appearance=createBitmapByName("actor1_05_gif"),this.animationList={idle_left:["actor1_06_gif"],idle_right:["Actor1_09_gif"],walk_left:["actor1_05_gif","actor1_06_gif","Actor1_07_gif","actor1_06_gif"],walk_right:["Actor1_08_gif","Actor1_09_gif","Actor1_10_gif","Actor1_09_gif"]},this.fsm=new StateMachine(new IdleState(this)),egret.startTick(this.fsm.runMachine,this.fsm),this.addChild(this.appearance)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.Move=function(t){this.fsm.switchState(new WalkState(this,t))},e}(egret.DisplayObjectContainer);egret.registerClass(Player,"Player");var IdleState=function(){function t(t){this.player=t}var e=(__define,t),i=e.prototype;return i.onInit=function(){this.player.curAnimation=new Animation(this.player.animationList[this.player.isLeftFacing?"idle_left":"idle_right"],this.player.appearance)},i.onRun=function(t){this.player.curAnimation.playCurcularly(t)},i.onCheck=function(){return this},i.onExit=function(){console.log("idle exit")},t}();egret.registerClass(IdleState,"IdleState",["State"]);var WalkState=function(){function t(t,e){this.player=t,this.targetPosition=e,this.player.isLeftFacing=e.x-this.player.x>0?!0:!1}var e=(__define,t),i=e.prototype;return i.onInit=function(){this.player.curAnimation=new Animation(this.player.animationList[this.player.isLeftFacing?"walk_left":"walk_right"],this.player.appearance,3);var t=egret.Tween.get(this.player);t.to({x:this.targetPosition.x,y:this.targetPosition.y},Math.sqrt(Math.pow(this.targetPosition.x-this.player.x,2)+Math.pow(this.targetPosition.y-this.player.y,2))/this.player.velocity,egret.Ease.sineInOut)},i.onRun=function(t){this.player.curAnimation.playCurcularly(t)},i.onCheck=function(){return Math.abs(this.player.x-this.targetPosition.x)<1?new IdleState(this.player):this},i.onExit=function(){},t}();egret.registerClass(WalkState,"WalkState",["State"]);var AttackState=function(){function t(t){this.player=t}var e=(__define,t),i=e.prototype;return i.onInit=function(){},i.onRun=function(t){},i.onCheck=function(){return this.player.hp<50?new IdleState(this.player):void 0},i.onExit=function(){},t}();egret.registerClass(AttackState,"AttackState",["State"]);var SIZE1=1,SIZE32=32,SIZE48=48,Vector2=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this._x=0,this._y=0,this._x=t,this._y=e}var e=__define,i=t,n=i.prototype;return e(n,"x",function(){return this._x},function(t){this._x=t}),e(n,"y",function(){return this._x},function(t){this._x=t}),t}();egret.registerClass(Vector2,"Vector2");var Vector2_pixel=function(t){function e(e,i,n){t.call(this,e,i),this.size=1,this.size=n,this.x=e*this.size,this.y=i*this.size}__extends(e,t);var i=__define,n=e,r=n.prototype;return i(r,"ix",function(){return this.x/this.size},function(t){this.x=t*this.size}),i(r,"iy",function(){return this.y/this.size},function(t){this.y=t*this.size}),i(r,"iPos",function(){return new Vector2(this.ix,this.iy)}),i(r,"Pos",function(){return new Vector2(this.x,this.y)}),e.PixelToReal=function(t){return t*SIZE1},e.RealToPixel=function(t){return t/SIZE1},e}(Vector2);egret.registerClass(Vector2_pixel,"Vector2_pixel");var Vector2_p32=function(t){function e(e,i){t.call(this,e,i,SIZE32)}__extends(e,t);var i=(__define,e);i.prototype;return e.PixelToReal=function(t){return t*SIZE32},e.RealToPixel=function(t){return t/SIZE32},e}(Vector2_pixel);egret.registerClass(Vector2_p32,"Vector2_p32");var Vector2_p48=function(t){function e(e,i){t.call(this,e,i,SIZE48)}__extends(e,t);var i=(__define,e);i.prototype;return e.PixelToReal=function(t){return t*SIZE48},e.RealToPixel=function(t){return t/SIZE48},e}(Vector2_pixel);egret.registerClass(Vector2_p48,"Vector2_p48");